/* ═══════════ UI COMPONENTS (Generic) ═══════════ */

/* ─── Cards & Panels ─── */
.glass-card {
    position: relative;
    z-index: var(--z-ui);
    box-sizing: border-box;
    max-width: 100%;
    border-radius: var(--radius-2);
    border: 1px solid var(--stroke-1);
    background:
        linear-gradient(165deg, color-mix(in oklab, var(--surface-1) 90%, rgba(255, 255, 255, 0.04)), color-mix(in oklab, var(--surface-1) 96%, transparent)),
        color-mix(in oklab, var(--surface-1) 90%, transparent);
    backdrop-filter: blur(16px);
    box-shadow: var(--shadow-soft), inset 0 1px 0 rgba(255, 255, 255, 0.04);
    transition:
        transform calc(180ms * max(var(--anim-speed), 0.01)) ease,
        box-shadow calc(180ms * max(var(--anim-speed), 0.01)) ease,
        border-color calc(180ms * max(var(--anim-speed), 0.01)) ease;
}

.player-card:hover,
.history-card:hover,
.setting-card:hover {
    border-color: color-mix(in oklab, var(--accent) 45%, var(--stroke-1));
    box-shadow: 0 10px 24px rgba(0, 0, 0, 0.3), inset 0 0 0 1px rgba(79, 209, 197, 0.08);
    transform: translateY(-1px);
}

.cinematic-panel {
    position: relative;
    overflow: hidden;
}

.cinematic-panel::before {
    content: '';
    position: absolute;
    inset-block-start: 0;
    inset-inline: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--stroke-1), transparent);
}

.section-card,
.player-card,
.history-card,
.setting-card,
.phase-card,
.timer-card,
.spy-count-panel,
.handoff-card,
.reveal-card {
    padding: var(--space-3);
    border-radius: var(--radius-2);
}

.section-card {
    border: 1px solid var(--stroke-1);
    background: linear-gradient(168deg, var(--surface-2), var(--surface-1));
    animation: cardRise 360ms ease;
    flex-shrink: 0;
}

.panel-grid {
    border: 1px solid var(--stroke-1);
    background: var(--surface-1);
}

/* ─── Typography & Chips ─── */
.eyebrow {
    color: var(--accent);
    letter-spacing: 0.1em;
    font-size: 0.7rem;
    margin-block-end: 0.25rem;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.2rem 0.5rem;
    border-radius: var(--radius-1);
    border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
    background: color-mix(in oklab, var(--accent) 8%, transparent);
    text-transform: uppercase;
}

.subtle {
    color: var(--text-soft);
    font-weight: 600;
    font-size: 0.9rem;
    line-height: var(--lh-body);
}

.metric-chip {
    border: 1px solid var(--stroke-1);
    border-radius: var(--radius-1);
    background: linear-gradient(170deg, rgba(13, 24, 41, 0.84), rgba(8, 14, 25, 0.94));
    min-height: auto;
    padding: 0.8rem 1rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 0.15rem;
    box-shadow: inset 0 0 0 1px rgba(165, 200, 239, 0.08);
}

.metric-chip strong {
    font-size: 1.18rem;
    line-height: 1;
    overflow-wrap: anywhere;
}

.metric-chip span {
    color: var(--text-soft);
    font-size: 0.85rem;
    line-height: var(--lh-compact);
    overflow-wrap: anywhere;
}

.metric-chip--priority {
    border-color: color-mix(in oklab, var(--accent) 42%, var(--stroke-1));
    background:
        linear-gradient(165deg, color-mix(in oklab, var(--accent) 16%, rgba(15, 24, 40, 0.9)), rgba(8, 14, 25, 0.96));
    box-shadow:
        inset 0 0 0 1px color-mix(in oklab, var(--accent) 20%, transparent),
        0 0 0 1px rgba(0, 0, 0, 0.2);
}

.section-count-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 1.7rem;
    padding: 0.15rem 0.6rem;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.36);
    background: rgba(255, 255, 255, 0.08);
    color: var(--text-main);
    font-size: 0.78rem;
    font-weight: 700;
    line-height: var(--lh-compact);
    letter-spacing: 0.04em;
    white-space: normal;
    text-align: center;
}

/* ─── Banners ─── */
.status-banner {
    border-radius: var(--radius-1);
    border: 1px solid var(--stroke-1);
    padding: var(--space-2) var(--space-3);
    padding-inline-start: var(--space-4);
    background:
        linear-gradient(160deg, rgba(255, 255, 255, 0.045), rgba(255, 255, 255, 0)),
        var(--surface-1);
    color: var(--text-main);
    position: relative;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    line-height: var(--lh-body);
    overflow-wrap: anywhere;
    word-break: break-word;
    animation: cardRise 360ms ease;
}

.status-banner::before {
    content: '';
    position: absolute;
    inset-block: var(--space-2);
    inset-inline-start: var(--space-2);
    width: 4px;
    border-radius: 2px;
    background: var(--accent);
}

.status-banner.tone-warning {
    border-color: color-mix(in oklab, var(--warning) 40%, transparent);
}

.status-banner.tone-warning::before {
    background: var(--warning);
}

.status-banner.tone-danger {
    border-color: color-mix(in oklab, var(--danger) 40%, transparent);
}

.status-banner.tone-danger::before {
    background: var(--danger);
}

.status-banner.tone-success {
    border-color: color-mix(in oklab, var(--success) 40%, transparent);
}

.status-banner.tone-success::before {
    background: var(--success);
}

.banner-actions {
    margin-top: var(--space-2);
}

/* ─── Buttons ─── */
.game-button {
    position: relative;
    z-index: var(--z-ui);
    min-height: 44px;
    border-radius: var(--radius-1);
    border: 1px solid var(--stroke-1);
    background: var(--surface-2);
    color: var(--text-primary);
    padding: 0.75rem 1.25rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    letter-spacing: 0.05em;
    font-family: var(--font-hud);
    font-weight: 600;
    text-transform: uppercase;
    transition:
        transform calc(120ms * max(var(--anim-speed), 0.01)) ease,
        border-color calc(150ms * max(var(--anim-speed), 0.01)) ease,
        background-color calc(150ms * max(var(--anim-speed), 0.01)) ease,
        box-shadow calc(180ms * max(var(--anim-speed), 0.01)) ease;
    /* 
       CRITICAL: Force pointer events to auto to override any parent's pointer-events: none
       CRITICAL: manipulation optimizes touch response by disabling double-tap zoom delay 
    */
    pointer-events: auto !important;
    touch-action: none;
}

.game-button:hover:not(:disabled) {
    border-color: var(--accent);
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25), inset 0 0 0 1px rgba(79, 209, 197, 0.2);
    transform: translateY(-1px);
}

.game-button:active:not(:disabled) {
    transform: translateY(0);
    box-shadow: inset 0 0 0 1px rgba(79, 209, 197, 0.14);
}

.game-button:focus-visible {
    outline: 2px solid color-mix(in oklab, var(--accent) 88%, white);
    outline-offset: 2px;
    box-shadow: 0 0 0 2px color-mix(in oklab, var(--accent) 24%, transparent);
}

.game-button:disabled {
    opacity: 0.46;
    filter: saturate(0.75);
}

.game-button__icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.game-button__label {
    line-height: var(--lh-compact);
    text-wrap: balance;
}

.game-button--md {
    min-height: 44px;
    font-size: 0.875rem;
}

.game-button--lg {
    min-height: 48px;
    font-size: 0.9375rem;
    font-weight: 600;
}

.game-button--hero {
    width: min(100%, 340px);
    padding-block: var(--space-4);
    padding-inline: var(--space-4);
    border-radius: var(--radius-3);
    /* Responsive hero text */
    font-size: clamp(1.15rem, 4.2vw, 1.4rem);
    font-weight: 700;
    letter-spacing: 0.08em;
    border-color: var(--accent);
    background: color-mix(in oklab, var(--accent) 12%, var(--surface-2));
}

.game-button--hero:hover:not(:disabled) {
    background: color-mix(in oklab, var(--accent) 20%, var(--surface-2));
}

.game-button--icon {
    padding-block: var(--space-3);
    padding-inline: var(--space-2);
    width: calc(33.333% - var(--space-2));
    min-height: 80px;
    border-radius: var(--radius-3);
    flex-direction: column;
    font-size: 0.75rem;
    letter-spacing: 0.08em;
    gap: 0.5rem;
}

.game-button--primary {
    border-color: var(--stroke-1);
    background: var(--surface-2);
}

.game-button--primary:hover:not(:disabled) {
    border-color: var(--accent);
}

.game-button--ghost {
    border-color: var(--stroke-2);
    background: color-mix(in oklab, var(--surface-2) 35%, transparent);
}

.game-button--ghost:hover:not(:disabled) {
    border-color: var(--stroke-1);
    background: var(--surface-1);
}

.game-button--danger {
    border-color: color-mix(in oklab, var(--danger) 50%, transparent);
    color: color-mix(in oklab, var(--danger) 85%, white);
}

.game-button--danger:hover:not(:disabled) {
    border-color: var(--danger);
}

.game-button--safe {
    border-color: color-mix(in oklab, var(--accent) 50%, transparent);
    color: var(--accent);
}

.game-button--safe:hover:not(:disabled) {
    border-color: var(--accent);
}

/* ─── CTA (Teal Call-to-Action) ─── */
.game-button--cta {
    border-color: transparent;
    background: linear-gradient(135deg, #2dd4bf, #14b8a6, #0d9488);
    color: #02201a;
    font-weight: 700;
    box-shadow:
        0 0 0 1px rgba(45, 212, 191, 0.3),
        0 2px 12px rgba(45, 212, 191, 0.2);
}

.game-button--cta:hover:not(:disabled) {
    border-color: transparent;
    background: linear-gradient(135deg, #5eead4, #2dd4bf, #14b8a6);
    box-shadow:
        0 0 0 1px rgba(45, 212, 191, 0.5),
        0 4px 24px rgba(45, 212, 191, 0.35);
}

.game-button--cta:disabled {
    opacity: 0.45;
    box-shadow: none;
}

.game-button--cta.game-button--hero {
    border-color: transparent;
    background: linear-gradient(135deg, #2dd4bf 0%, #14b8a6 50%, #0d9488 100%);
    box-shadow:
        0 0 0 1px rgba(45, 212, 191, 0.4),
        0 4px 28px rgba(45, 212, 191, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.18);
    animation: ctaPulse 2.8s ease-in-out infinite;
}

.game-button--cta.game-button--hero:hover:not(:disabled) {
    background: linear-gradient(135deg, #5eead4 0%, #2dd4bf 50%, #14b8a6 100%);
    box-shadow:
        0 0 0 2px rgba(45, 212, 191, 0.6),
        0 8px 36px rgba(45, 212, 191, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.22);
}

@keyframes ctaPulse {
    0%, 100% {
        box-shadow:
            0 0 0 1px rgba(45, 212, 191, 0.4),
            0 4px 28px rgba(45, 212, 191, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.18);
    }
    50% {
        box-shadow:
            0 0 0 2px rgba(45, 212, 191, 0.55),
            0 8px 36px rgba(45, 212, 191, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.22);
    }
}

.ghost-link {
    min-height: 46px;
    border-radius: var(--radius-1);
    padding: 0.62rem 1.05rem;
    border: 1px solid var(--stroke-1);
    background: linear-gradient(155deg, rgba(255, 255, 255, 0.04), rgba(9, 16, 30, 0.92));
    text-decoration: none;
    color: var(--text-main);
}

.ghost-link:hover {
    border-color: color-mix(in oklab, var(--accent) 40%, white);
}

.next-btn {
    min-height: 54px;
    padding: 0.75rem 1.6rem;
    font-size: 1.05rem;
    background: linear-gradient(135deg, #2dd4bf, #14b8a6);
    color: #02201a;
}

.next-btn:hover {
    opacity: 0.92;
}

.update-check-btn {
    width: 100%;
    justify-content: center;
    gap: 0.75rem;
}

.update-check-btn svg {
    flex-shrink: 0;
}

.game-button--update-available {
    border-color: var(--success);
    background: color-mix(in oklab, var(--success) 12%, var(--surface-2));
    color: var(--success);
    animation: updatePulse 2s ease-in-out infinite;
}

.game-button--update-available:hover:not(:disabled) {
    border-color: color-mix(in oklab, var(--success) 80%, white);
    background: color-mix(in oklab, var(--success) 18%, var(--surface-2));
}

/* ─── Actions & Headers ─── */
.primary-action-bar {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--space-3);
    padding: var(--space-2) var(--space-3);
    border: 1px solid var(--stroke-1);
    background: color-mix(in oklab, var(--surface-1) 90%, transparent);
    backdrop-filter: blur(14px);
    border-radius: var(--radius-1);
    animation: cardRise 360ms ease;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06);
}

.sticky-action-bar {
    position: sticky;
    inset-block-end: var(--space-2);
    z-index: var(--z-sticky);
    margin-top: auto;
    /* Extra padding for floating action bars on mobile */
    padding-block-end: calc(var(--space-2) + env(safe-area-inset-bottom));
}

.reveal-action-bar {
    position: sticky;
    inset-block-end: var(--space-2);
    z-index: var(--z-sticky);
    margin-top: auto;
    border-color: color-mix(in oklab, var(--accent) 40%, transparent);
    /* Extra padding for floating action bars on mobile */
    padding-block-end: calc(var(--space-2) + env(safe-area-inset-bottom));
}

.reveal-action-bar .action-main {
    justify-content: center;
}

.reveal-action-bar .next-btn {
    min-width: min(100%, 240px);
    min-height: 48px;
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 0.04em;
}

.action-leading {
    flex: 1;
    min-width: min(11rem, 100%);
    color: var(--text-soft);
    font-weight: 600;
}

.action-main {
    display: flex;
    justify-content: flex-end;
    flex: 1;
    min-width: min(11rem, 100%);
    flex-wrap: wrap;
    gap: var(--space-2);
}

.action-main>*,
.action-leading>* {
    max-width: 100%;
}

.actions-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-2);
}

.case-actions {
    justify-content: center;
    padding: 0.16rem 0;
    flex-wrap: wrap;
}

.case-actions .game-button {
    flex: 1 1 180px;
}

.section-heading {
    display: flex;
    align-items: flex-end;
    flex-wrap: wrap;
    justify-content: space-between;
    column-gap: var(--space-2);
    row-gap: 0.35rem;
}

.section-heading h2 {
    margin: 0;
    font-size: clamp(1.2rem, 4.2vw, 1.8rem);
    line-height: var(--lh-heading);
}

.section-heading .subtle {
    max-width: 32ch;
    color: color-mix(in oklab, var(--text-soft) 88%, white);
}

.section-heading--stack {
    flex-direction: column;
    align-items: flex-start;
    justify-content: flex-start;
    gap: var(--space-1);
}

.section-heading--stack .subtle {
    max-width: 100%;
}

.stack-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

/* ─── Forms ─── */
.form-field {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
}

.form-field span {
    color: var(--text-secondary);
    font-weight: 600;
}

.input-row {
    display: flex;
    gap: var(--space-2);
    align-items: center;
    width: 100%;
}

.input-row>input,
.input-row>select {
    flex: 1 1 auto;
    min-width: 0;
}

input,
select {
    border-radius: var(--radius-1);
    border: 1px solid var(--stroke-1);
    background: linear-gradient(152deg, rgba(20, 34, 52, 0.74), rgba(7, 13, 24, 0.95));
    color: var(--text-main);
    min-height: 2.55rem;
    padding: 0.45rem 0.7rem;
    transition:
        border-color calc(120ms * max(var(--anim-speed), 0.01)) ease,
        box-shadow calc(120ms * max(var(--anim-speed), 0.01)) ease,
        background-color calc(120ms * max(var(--anim-speed), 0.01)) ease;
}

input::placeholder {
    color: color-mix(in oklab, var(--text-dim) 80%, white);
}

input:focus,
select:focus,
button:focus-visible,
a:focus-visible {
    outline: 2px solid color-mix(in oklab, var(--accent) 80%, white);
    outline-offset: 1px;
    border-color: color-mix(in oklab, var(--accent) 65%, white);
    box-shadow: 0 0 0 2px color-mix(in oklab, var(--accent) 25%, transparent);
}

input[type='range'] {
    padding: 0;
    accent-color: var(--accent);
}

.switch-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-2);
}

.switch-row input[type='checkbox'] {
    width: 1.18rem;
    height: 1.18rem;
    accent-color: var(--accent);
    border-radius: 0.3rem;
}

/* ═══════════ GAMEPLAY COMPONENTS ═══════════ */

/* ─── Phase Progress Bar ─── */
.phase-bar {
    flex-shrink: 0;
    padding: 1rem 1.25rem 2.5rem;
    border: 1px solid var(--stroke-1);
    background: linear-gradient(168deg, var(--surface-2), var(--surface-1));
    border-radius: var(--radius-2);
}

.phase-bar__track {
    position: relative;
    height: 6px;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 999px;
    overflow: visible;
}

.phase-bar__fill {
    position: absolute;
    inset-block-start: 0;
    inset-inline-start: 0;
    height: 100%;
    background: linear-gradient(90deg, var(--accent-primary), var(--accent-strong));
    border-radius: 999px;
    transition: width 500ms cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 0 10px rgba(56, 217, 197, 0.35);
}

.phase-bar__node {
    position: absolute;
    top: 50%;
    transform: translate(50%, -50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.phase-bar__dot {
    width: 1.75rem;
    height: 1.75rem;
    border-radius: 999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-hud);
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 0.02em;
    border: 2px solid rgba(255, 255, 255, 0.12);
    background: var(--bg-depth);
    color: var(--text-muted);
    transition: all 400ms cubic-bezier(0.4, 0, 0.2, 1);
}

.phase-bar__node.done .phase-bar__dot {
    background: var(--accent-primary);
    border-color: var(--accent-primary);
    color: #06121d;
    font-size: 0.65rem;
}

.phase-bar__node.current .phase-bar__dot {
    background: linear-gradient(140deg, var(--accent-strong), var(--accent-primary));
    border-color: var(--accent-primary);
    color: #06121d;
    box-shadow: 0 0 0 4px rgba(56, 217, 197, 0.2), 0 0 16px rgba(56, 217, 197, 0.3);
}

.phase-bar__label {
    position: absolute;
    top: calc(100% + 0.45rem);
    white-space: nowrap;
    font-size: 0.72rem;
    font-weight: 600;
    color: var(--text-muted);
    transition: color 300ms ease;
}

.phase-bar__node.done .phase-bar__label {
    color: var(--text-secondary);
}

.phase-bar__node.current .phase-bar__label {
    color: var(--accent-primary);
    font-weight: 700;
}

/* ─── Player Row/Card ─── */
.player-row {
    display: grid;
    grid-template-columns: auto minmax(0, 1fr) auto;
    grid-template-areas: "avatar main actions";
    align-items: start;
    column-gap: var(--space-2);
    row-gap: var(--space-1);
    width: 100%;
}

.player-row .player-avatar {
    grid-area: avatar;
}

.player-avatar {
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid rgba(79, 209, 197, 0.45);
    background: rgba(14, 26, 36, 0.8);
    box-shadow: 0 0 0 2px rgba(79, 209, 197, 0.15);
}

.player-avatar-wrap {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    flex-shrink: 0;
}

.player-avatar-wrap::after {
    content: '';
    position: absolute;
    inset: -3px;
    border-radius: 50%;
    border: 1.5px solid rgba(79, 209, 197, 0.25);
    pointer-events: none;
}

.player-avatar-wrap--ai::after {
    border-color: rgba(229, 62, 62, 0.4);
    box-shadow: 0 0 8px rgba(229, 62, 62, 0.2);
}

.player-avatar-wrap--ai .player-avatar {
    border-color: rgba(229, 62, 62, 0.5);
}

.player-main {
    grid-area: main;
    flex: 0 1 auto;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.player-nameplate {
    display: grid;
    gap: 0.3rem;
    min-width: 0;
}

.player-nameplate--compact {
    gap: 0.22rem;
}

.player-nameplate__row {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    flex-wrap: wrap;
    min-width: 0;
}

.player-nameplate__name {
    font-weight: 700;
    line-height: var(--lh-heading);
    overflow-wrap: anywhere;
}

.level-badge {
    display: inline-grid;
    align-items: center;
    gap: 0.22rem;
    min-width: 0;
}

.level-badge--compact {
    gap: 0.12rem;
}

.level-chip {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 1.1rem;
    padding: 0.12rem 0.44rem;
    border-radius: 999px;
    border: 1px solid color-mix(in oklab, var(--accent) 36%, transparent);
    background: color-mix(in oklab, var(--panel) 78%, var(--accent) 10%);
    color: var(--text-main);
    font-size: 0.65rem;
    font-weight: 800;
    letter-spacing: 0.08em;
    text-transform: uppercase;
}

.level-chip--ember {
    border-color: rgba(255, 160, 60, 0.45);
    background: linear-gradient(125deg, #1a0f04 0%, #3d2008 50%, #6b3a10 100%);
    color: #ffd4a8;
    box-shadow: 0 0 var(--fire-spread, 4px) rgba(255, 140, 40, var(--fire-glow, 0.15));
    animation: fire-ember var(--fire-speed, 1.6s) ease-in-out infinite;
}

.level-chip--flame {
    border-color: rgba(255, 204, 102, 0.65);
    background: linear-gradient(125deg, #2f1a04 0%, #7a4a12 38%, #d1a743 60%, #a06d20 100%);
    color: #fff3ca;
    box-shadow: 0 0 var(--fire-spread, 8px) rgba(255, 180, 50, var(--fire-glow, 0.3));
    animation: fire-flame var(--fire-speed, 1.2s) ease-in-out infinite;
}

.level-chip--flame::after {
    content: '';
    position: absolute;
    inset: -3px -1px auto -1px;
    height: calc(4px + var(--fire-intensity, 0.2) * 6px);
    border-radius: 8px 8px 2px 2px;
    background: radial-gradient(ellipse at 50% 100%, rgba(255, 200, 100, 0.7), rgba(255, 150, 40, 0.15) 70%, transparent 90%);
    opacity: calc(0.4 + var(--fire-intensity, 0.2) * 0.4);
    pointer-events: none;
    filter: blur(1px);
    animation: fire-tongue var(--fire-speed, 1.2s) ease-in-out infinite;
}

.level-chip--inferno {
    border-color: rgba(255, 110, 40, 0.8);
    background: linear-gradient(125deg, #2a0b02 0%, #6d1408 35%, #d63716 62%, #ff8c2a 100%);
    color: #fff1d9;
    box-shadow: 0 0 var(--fire-spread, 14px) rgba(255, 87, 34, var(--fire-glow, 0.5));
    animation: fire-inferno var(--fire-speed, 0.9s) ease-in-out infinite;
}

.level-chip--inferno::before {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: inherit;
    background: radial-gradient(ellipse at 50% 0%, rgba(255, 120, 40, 0.3), transparent 70%);
    pointer-events: none;
    animation: fire-aura calc(var(--fire-speed, 0.9s) * 0.7) ease-in-out infinite alternate;
}

.level-chip--inferno::after {
    content: '';
    position: absolute;
    inset: -5px -3px auto -3px;
    height: calc(6px + var(--fire-intensity, 0.4) * 10px);
    border-radius: 10px 10px 3px 3px;
    background: radial-gradient(ellipse at 30% 100%, rgba(255, 222, 158, 0.85), rgba(255, 95, 31, 0.25) 60%, transparent 85%);
    opacity: calc(0.6 + var(--fire-intensity, 0.4) * 0.35);
    pointer-events: none;
    filter: blur(calc(0.5px + var(--fire-intensity, 0.4) * 1.5px));
    animation: fire-tongue calc(var(--fire-speed, 0.9s) * 0.6) ease-in-out infinite;
}

.level-chip--mythic-fire {
    border-color: rgba(255, 60, 100, 0.85);
    background: linear-gradient(125deg, #1a0020 0%, #5c0a2a 30%, #c41840 55%, #ff6b35 85%, #ffa040 100%);
    color: #ffe8f0;
    box-shadow: 0 0 var(--fire-spread, 18px) rgba(255, 50, 80, var(--fire-glow, 0.65)),
                0 0 calc(var(--fire-spread, 18px) * 2) rgba(180, 30, 120, calc(var(--fire-glow, 0.65) * 0.3));
    animation: fire-mythic var(--fire-speed, 0.6s) ease-in-out infinite;
}

.level-chip--mythic-fire::before {
    content: '';
    position: absolute;
    inset: -3px;
    border-radius: inherit;
    background: conic-gradient(from 0deg, rgba(255, 60, 100, 0.3), rgba(180, 30, 180, 0.2), rgba(255, 120, 40, 0.3), rgba(255, 60, 100, 0.3));
    pointer-events: none;
    animation: fire-ring calc(var(--fire-speed, 0.6s) * 3) linear infinite;
}

.level-chip--mythic-fire::after {
    content: '';
    position: absolute;
    inset: -7px -4px auto -4px;
    height: calc(8px + var(--fire-intensity, 0.7) * 14px);
    border-radius: 12px 12px 4px 4px;
    background: radial-gradient(ellipse at 40% 100%, rgba(255, 180, 200, 0.8), rgba(255, 60, 100, 0.35) 50%, rgba(180, 30, 180, 0.1) 80%, transparent 95%);
    opacity: calc(0.7 + var(--fire-intensity, 0.7) * 0.28);
    pointer-events: none;
    filter: blur(calc(1px + var(--fire-intensity, 0.7) * 2px));
    animation: fire-tongue calc(var(--fire-speed, 0.6s) * 0.5) ease-in-out infinite;
}

.level-chip--legendary {
    border-color: rgba(180, 220, 255, 0.9);
    background: linear-gradient(125deg, #000820 0%, #0a1a5c 25%, #1a3aaa 45%, #4488ff 65%, #88ccff 85%, #ccefff 100%);
    color: #ffffff;
    box-shadow: 0 0 var(--fire-spread, 24px) rgba(100, 180, 255, var(--fire-glow, 0.85)),
                0 0 calc(var(--fire-spread, 24px) * 2.5) rgba(60, 120, 255, calc(var(--fire-glow, 0.85) * 0.4)),
                0 0 calc(var(--fire-spread, 24px) * 4) rgba(160, 200, 255, calc(var(--fire-glow, 0.85) * 0.15));
    animation: fire-legendary var(--fire-speed, 0.4s) ease-in-out infinite;
    text-shadow: 0 0 6px rgba(200, 230, 255, 0.8);
}

.level-chip--legendary::before {
    content: '';
    position: absolute;
    inset: -4px;
    border-radius: inherit;
    background: conic-gradient(from 0deg, rgba(100, 180, 255, 0.4), rgba(200, 230, 255, 0.3), rgba(60, 120, 255, 0.4), rgba(100, 180, 255, 0.4));
    pointer-events: none;
    animation: fire-ring calc(var(--fire-speed, 0.4s) * 2.5) linear infinite;
}

.level-chip--legendary::after {
    content: '';
    position: absolute;
    inset: -10px -6px auto -6px;
    height: calc(12px + var(--fire-intensity, 1) * 16px);
    border-radius: 14px 14px 5px 5px;
    background: radial-gradient(ellipse at 50% 100%, rgba(200, 230, 255, 0.8), rgba(100, 180, 255, 0.4) 40%, rgba(60, 120, 255, 0.15) 70%, transparent 95%);
    opacity: 0.9;
    pointer-events: none;
    filter: blur(calc(1.5px + var(--fire-intensity, 1) * 2px));
    animation: fire-tongue calc(var(--fire-speed, 0.4s) * 0.4) ease-in-out infinite;
}

.level-xp {
    color: var(--text-soft);
    font-size: 0.68rem;
}

.level-progress {
    position: relative;
    display: block;
    width: 100%;
    max-width: 7rem;
    height: 4px;
    border-radius: 999px;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.12);
}

.level-progress__fill {
    position: absolute;
    inset: 0;
    transform-origin: left center;
    background: linear-gradient(90deg, #3bc9b9 0%, #4fd1c5 50%, #94fff5 100%);
}

.medal-strip {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.3rem;
}

.medal-chip {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.2rem 0.5rem;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    font-size: 0.65rem;
    font-weight: 600;
    white-space: nowrap;
    max-width: 9rem;
    overflow: hidden;
    text-overflow: ellipsis;
    backdrop-filter: blur(4px);
    transition: transform 200ms ease, box-shadow 200ms ease;
}

.medal-chip:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.medal-chip__label {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.medal-chip--bronze {
    border-color: rgba(205, 127, 50, 0.5);
    background: linear-gradient(135deg, rgba(205, 127, 50, 0.18), rgba(139, 90, 30, 0.12));
    color: #ffd8b0;
}

.medal-chip--silver {
    border-color: rgba(184, 196, 210, 0.5);
    background: linear-gradient(135deg, rgba(184, 196, 210, 0.18), rgba(107, 122, 141, 0.12));
    color: #f1f7ff;
}

.medal-chip--gold {
    border-color: rgba(255, 198, 79, 0.6);
    background: linear-gradient(135deg, rgba(255, 198, 79, 0.22), rgba(160, 109, 32, 0.15));
    color: #fff2c0;
    box-shadow: 0 0 6px rgba(255, 198, 79, 0.15);
}

.medal-chip--mythic {
    border-color: rgba(255, 112, 67, 0.65);
    background: linear-gradient(135deg, rgba(255, 112, 67, 0.25), rgba(191, 54, 12, 0.18));
    color: #ffd9c9;
    box-shadow: 0 0 8px rgba(255, 112, 67, 0.2);
}

.medal-chip--empty {
    color: var(--text-dim);
}

.medal-chip--extra {
    border-style: dashed;
}

.pick-card-nameplate {
    width: 100%;
}

.player-progress-log {
    margin-top: var(--space-2);
    padding-top: var(--space-2);
    border-top: 1px solid var(--stroke-2);
    display: grid;
    gap: 0.55rem;
}

.player-progress-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.6rem;
}

.player-progress-track {
    position: relative;
    height: 8px;
    border-radius: 999px;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.1);
}

.player-progress-track__fill {
    position: absolute;
    inset: 0;
    transform-origin: left center;
    background: linear-gradient(90deg, #33d1bf, #88f8ef);
}

.medal-catalog-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(8rem, 100%), 1fr));
    gap: 0.4rem;
}

.medal-catalog-item {
    display: grid;
    gap: 0.18rem;
    padding: 0.35rem 0.46rem;
    border-radius: 0.5rem;
    border: 1px solid var(--stroke-2);
    background: rgba(255, 255, 255, 0.03);
    color: var(--text-soft);
}

.medal-catalog-item small {
    color: var(--text-dim);
    font-size: 0.64rem;
}

.medal-catalog-item.is-locked {
    opacity: 0.42;
    filter: grayscale(1);
}

.medal-catalog-item.is-unlocked {
    opacity: 1;
}

.medal-catalog-item--bronze.is-unlocked {
    border-color: rgba(205, 127, 50, 0.58);
}

.medal-catalog-item--silver.is-unlocked {
    border-color: rgba(184, 196, 210, 0.68);
}

.medal-catalog-item--gold.is-unlocked {
    border-color: rgba(255, 198, 79, 0.72);
}

.medal-catalog-item--mythic.is-unlocked {
    border-color: rgba(255, 112, 67, 0.82);
}

.player-events-list {
    display: grid;
    gap: 0.35rem;
    max-height: 15rem;
    overflow-y: auto;
    padding-right: 0.2rem;
}

.player-event-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    padding: 0.3rem 0.42rem;
    border-radius: 0.48rem;
    background: rgba(255, 255, 255, 0.04);
}

.player-event-item small {
    color: var(--text-dim);
    font-size: 0.66rem;
}

.restart-leading-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 0.35rem;
}

.restart-round-note {
    display: block;
    text-align: center;
}

.resolution-restart-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.75rem;
    flex-wrap: wrap;
}

.round-awards-list {
    display: grid;
    gap: 0.55rem;
}

.round-award-card {
    padding: 0.55rem 0.7rem;
    border: 1px solid var(--stroke-2);
    border-radius: 0.55rem;
    background: rgba(255, 255, 255, 0.04);
    display: grid;
    gap: 0.28rem;
}

.player-main h3 {
    line-height: var(--lh-heading);
    overflow-wrap: anywhere;
}

.ai-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 1.35rem;
    padding: 0.12rem 0.5rem;
    border-radius: 999px;
    border: 1px solid color-mix(in oklab, var(--accent) 50%, rgba(255, 255, 255, 0.2));
    background: color-mix(in oklab, var(--accent) 18%, rgba(7, 14, 25, 0.92));
    color: var(--text-main);
    font-size: 0.72rem;
    font-weight: 800;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    vertical-align: middle;
}

.ai-badge--small {
    min-height: 1.15rem;
    padding: 0.06rem 0.42rem;
    font-size: 0.66rem;
}

.player-main p {
    color: var(--text-soft);
    line-height: var(--lh-compact);
}

.player-actions {
    grid-area: actions;
    display: flex;
    gap: var(--space-1);
    justify-content: flex-end;
    align-items: stretch;
    flex-wrap: wrap;
}

.player-actions .game-button {
    flex: 0 0 auto;
}

.stats-grid {
    margin-block-start: var(--space-2);
    padding-block-start: var(--space-2);
    border-block-start: 1px solid var(--stroke-2);
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(9rem, 100%), 1fr));
    gap: var(--space-1) var(--space-2);
    color: var(--text-soft);
    font-size: 0.9rem;
    line-height: var(--lh-body);
}

.stats-grid span {
    display: block;
    min-width: 0;
    word-break: break-word;
}

/* ─── Player Selection ─── */
.player-select-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(10rem, 100%), 1fr));
    justify-items: stretch;
    align-items: stretch;
    gap: var(--space-2);
}

.player-select-grid.compact {
    grid-template-columns: repeat(auto-fit, minmax(min(7.25rem, 100%), 1fr));
}

.player-select-grid>* {
    width: 100%;
}

.pick-card {
    min-height: auto;
    padding: var(--space-3);
    /* Increased touch target */
    border: 1px solid var(--stroke-1);
    color: var(--text-main);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.42rem;
    border-radius: var(--radius-1);
    background:
        linear-gradient(155deg, rgba(120, 180, 255, 0.08), transparent 36%),
        rgba(7, 14, 25, 0.95);
    position: relative;
    transition: all 0.2s ease;
}

.pick-card span {
    line-height: 1.2;
}

.pick-card-name {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.45rem;
    flex-wrap: wrap;
    text-align: center;
}

.pick-card.selected {
    border-color: var(--accent);
    background: color-mix(in oklab, var(--accent) 15%, rgba(7, 14, 25, 0.95));
    box-shadow:
        0 0 0 2px var(--accent),
        0 0 15px color-mix(in oklab, var(--accent) 40%, transparent);
    transform: translateY(-2px);
}

/* ─── Spy Controls ─── */
.spy-count-panel {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-2);
}

.setup-spy-panel {
    flex-direction: column;
    align-items: stretch;
    justify-content: flex-start;
    gap: var(--space-2);
    flex-shrink: 0;
    min-height: auto;
}

.setup-spy-panel--primary {
    border-color: color-mix(in oklab, var(--accent) 45%, var(--stroke-1));
    box-shadow:
        inset 0 0 0 1px color-mix(in oklab, var(--accent) 18%, transparent),
        0 0 0 1px rgba(0, 0, 0, 0.16);
}

.setup-spy-panel__header {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: var(--space-2);
    flex-wrap: wrap;
}

.setup-spy-panel__current {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 1.7rem;
    padding: 0.14rem 0.62rem;
    border-radius: 999px;
    border: 1px solid color-mix(in oklab, var(--accent) 35%, var(--stroke-1));
    background: color-mix(in oklab, var(--accent) 14%, rgba(10, 18, 32, 0.95));
    color: color-mix(in oklab, var(--accent) 72%, white);
    font-size: 0.78rem;
    font-weight: 700;
    letter-spacing: 0.04em;
}

.toggle-panel {
    border: 1px solid var(--stroke-1);
    background: var(--surface-2);
}

.pill-row {
    display: inline-flex;
    max-width: 100%;
    background: rgba(16, 29, 47, 0.9);
    padding: 0.22rem;
    border-radius: 999px;
    border: 1px solid rgba(124, 168, 223, 0.3);
}

.setup-pill-row {
    width: 100%;
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 0.28rem;
    border-radius: 0.9rem;
    padding: 0.28rem;
    flex-shrink: 0;
}

.setup-pill-row .pill-btn {
    min-height: 50px;
    flex-shrink: 0;
}

.pill-btn {
    min-width: 44px;
    min-height: 44px;
    border: none;
    border-radius: 999px;
    background: transparent;
    color: var(--text-main);
    cursor: pointer;
    transition: background calc(150ms * max(var(--anim-speed), 0.01)) ease,
        box-shadow calc(150ms * max(var(--anim-speed), 0.01)) ease;
}

.pill-btn:hover:not(.active) {
    background: rgba(255, 255, 255, 0.08);
    box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.12);
}

.pill-btn.active {
    background: linear-gradient(140deg, color-mix(in oklab, var(--accent) 82%, white), var(--accent));
    color: #06121d;
    font-weight: 700;
}

.setup-action-bar {
    border-color: color-mix(in oklab, var(--accent) 34%, var(--stroke-1));
    box-shadow:
        0 10px 28px rgba(0, 0, 0, 0.28),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.setup-action-leading {
    display: inline-flex;
    align-items: center;
    min-height: 1.8rem;
    padding: 0.1rem 0.56rem;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.18);
    background: rgba(8, 13, 24, 0.85);
    font-size: 0.8rem;
    letter-spacing: 0.03em;
    color: var(--text-soft);
}

.setup-action-bar .action-main {
    align-items: center;
}

.setup-start-btn {
    min-width: min(100%, 13rem);
}

/* ─── Handoff & Reveal ─── */
.handoff-card,
.phase-card,
.timer-card {
    text-align: center;
}

.phase-card,
.timer-card,
.history-card {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.handoff-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2);
}

.reveal-card {
    text-align: center;
    user-select: none;
    -webkit-user-select: none;
}

.reveal-mask-wrapper {
    position: relative;
    margin-block-start: var(--space-2);
    border-radius: var(--radius-2);
    overflow: hidden;
    --reveal-mask-envelope: clamp(17.2rem, 48vh, 24.4rem);
}

.reveal-mask-wrapper--concealed {
    block-size: var(--reveal-mask-envelope);
}

.reveal-mask-wrapper--concealed .reveal-content {
    position: absolute;
    inset: 0;
    block-size: 100%;
    min-block-size: 100%;
    overflow: hidden;
    opacity: 0.12;
    filter: blur(12px) saturate(0.9);
    transform: scale(1.035);
    pointer-events: none;
}

.reveal-mask-wrapper--revealed {
    block-size: auto;
    min-block-size: 0;
}

.reveal-content {
    min-block-size: auto;
    border-radius: var(--radius-2);
    background:
        linear-gradient(140deg, rgba(255, 79, 109, 0.06), transparent 36%),
        linear-gradient(160deg, rgba(88, 240, 210, 0.08), rgba(7, 14, 25, 0.94));
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-4);
    overflow: hidden;
    /* Prevent spillover */
    font-size: 1.2rem;
    text-align: center;
    user-select: none;
    -webkit-user-select: none;
    transition:
        filter calc(220ms * max(var(--anim-speed), 0.01)) ease,
        opacity calc(220ms * max(var(--anim-speed), 0.01)) ease,
        transform calc(220ms * max(var(--anim-speed), 0.01)) ease;
}

.reveal-meta {
    display: flex;
    flex-direction: column;
    gap: 0.45rem;
    align-items: center;
}

.spy-meta-grid {
    width: min(100%, 32rem);
    gap: 0.82rem;
    display: grid;
    justify-items: center;
}

.role-title {
    margin: 0;
    font-size: clamp(1.6rem, 6vw, 2.2rem);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    font-family: var(--font-display);
}

.role-title-spy {
    color: color-mix(in oklab, var(--danger) 70%, white);
}

.role-title-citizen {
    color: color-mix(in oklab, var(--success) 70%, white);
}

.spy-category-pill {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    border: 1px solid color-mix(in oklab, var(--accent) 40%, white);
    border-radius: 999px;
    padding: 0.28rem 0.62rem;
    background: rgba(77, 215, 255, 0.12);
    color: #d8f4ff;
    font-size: 0.92rem;
}

.spy-category-pill strong {
    color: #ffffff;
    letter-spacing: 0.03em;
}

.spy-hint-box {
    width: 100%;
    border: 1px solid rgba(255, 255, 255, 0.18);
    border-radius: 0.78rem;
    padding: 0.52rem 0.6rem;
    background: linear-gradient(160deg, rgba(17, 32, 48, 0.78), rgba(7, 14, 25, 0.95));
}

.spy-hint-label {
    display: block;
    color: var(--text-soft);
    font-size: 0.76rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-block-end: 0.22rem;
}

.spy-hint {
    color: #eef7ff;
    opacity: 0.96;
    font-size: 0.98rem;
    line-height: 1.42;
    max-width: 100%;
    filter: none;
}

.spy-team-note {
    color: color-mix(in oklab, var(--accent-2) 72%, white);
    border: 1px solid color-mix(in oklab, var(--accent-2) 35%, white);
    background: rgba(123, 255, 202, 0.08);
    border-radius: 0.7rem;
    padding: 0.35rem 0.58rem;
    font-size: 0.88rem;
    font-weight: 600;
}

/* ─── Spy Hero Title (big red "أنت الجاسوس") ─── */
.spy-hero-title {
    margin: 0;
    font-size: clamp(2.4rem, 11vw, 4.2rem) !important;
    letter-spacing: 0.06em;
    line-height: 1.05;
    text-align: center;
    text-transform: none;
    text-shadow: 0 0 18px rgba(229, 62, 62, 0.45), 0 0 40px rgba(229, 62, 62, 0.2);
    animation: spy-pulse 2s ease-in-out infinite;
}

@keyframes spy-pulse {

    0%,
    100% {
        text-shadow: 0 0 18px rgba(229, 62, 62, 0.45), 0 0 40px rgba(229, 62, 62, 0.2);
    }

    50% {
        text-shadow: 0 0 24px rgba(229, 62, 62, 0.65), 0 0 50px rgba(229, 62, 62, 0.35);
    }
}

/* ─── Spy Category Display (clear, readable) ─── */
.spy-category-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    width: min(100%, 22rem);
    padding: 0.62rem 1rem;
    border: 1px solid color-mix(in oklab, var(--accent) 40%, white);
    border-radius: var(--radius-2);
    background: rgba(77, 215, 255, 0.08);
}

.spy-category-label {
    font-size: 0.78rem;
    color: var(--text-soft);
    letter-spacing: 0.08em;
    text-transform: uppercase;
}

.spy-category-name {
    font-size: clamp(1.3rem, 5.4vw, 1.92rem);
    color: #ffffff;
    letter-spacing: 0.04em;
    line-height: 1.18;
}

/* ─── Spy Team Banner (2-spy games) ─── */
.spy-team-banner {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    width: 100%;
    padding: 0.6rem 0.8rem;
    border-radius: var(--radius-2);
    border: 1px solid color-mix(in oklab, var(--accent-2) 50%, transparent);
    background: linear-gradient(135deg, rgba(123, 255, 202, 0.12), rgba(77, 215, 255, 0.08));
    animation: team-glow 2.5s ease-in-out infinite;
}

@keyframes team-glow {

    0%,
    100% {
        box-shadow: 0 0 0 1px rgba(123, 255, 202, 0.15);
    }

    50% {
        box-shadow: 0 0 12px rgba(123, 255, 202, 0.25);
    }
}

.spy-team-banner-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.spy-team-banner-content {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
}

.spy-team-banner-label {
    font-size: 0.72rem;
    color: var(--text-soft);
    letter-spacing: 0.08em;
    text-transform: uppercase;
}

.spy-team-banner-names {
    color: color-mix(in oklab, var(--accent-2) 85%, white);
    font-size: 1.1rem;
    letter-spacing: 0.03em;
}

.reveal-content strong {
    font-size: clamp(1.8rem, 9vw, 2.9rem);
}

.word-display {
    display: block;
    margin-block-start: 0.45rem;
    letter-spacing: 0.06em;
    font-size: clamp(2.1rem, 11vw, 3.4rem);
    font-weight: 700;
    /* Ensure long words break on mobile */
    overflow-wrap: anywhere;
    word-break: break-word;
    line-height: 1.1;
}

@keyframes revealScanline {
    0% { background-position: 0 0, 0 0, 0 0, 0 0, 0 0; }
    100% { background-position: 0 0, 0 -120px, 0 0, 0 0, 0 0; }
}

@keyframes revealPulse {
    0%, 100% { box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04), inset 0 -34px 50px rgba(0,0,0,0.28); }
    50% { box-shadow: inset 0 0 0 1px rgba(77,215,255,0.12), inset 0 -34px 50px rgba(0,0,0,0.28), 0 0 20px rgba(77,215,255,0.08); }
}

@keyframes holdShake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-1px); }
    40% { transform: translateX(1.5px); }
    60% { transform: translateX(-1px); }
    80% { transform: translateX(0.5px); }
}

@keyframes trackShimmer {
    0% { background-position: -200% 0, 0 0, 0 0; }
    100% { background-position: 200% 0, 0 0, 0 0; }
}

.reveal-mask {
    position: absolute;
    inset: 0;
    border: 1px solid color-mix(in oklab, var(--accent) 42%, rgba(255, 255, 255, 0.2));
    border-radius: var(--radius-2);
    background-color: rgba(4, 8, 14, 0.97);
    background-image:
        repeating-linear-gradient(120deg,
            transparent 0 10px,
            rgba(77, 215, 255, 0.06) 10px 12px),
        repeating-linear-gradient(180deg,
            rgba(255, 255, 255, 0.04) 0 2px,
            transparent 2px 6px),
        radial-gradient(circle at 12% 14%, rgba(77, 215, 255, 0.18), transparent 30%),
        radial-gradient(circle at 82% 78%, rgba(123, 255, 202, 0.14), transparent 35%),
        linear-gradient(135deg, rgba(7, 16, 28, 0.9), rgba(4, 8, 14, 0.97));
    background-repeat: no-repeat;
    backdrop-filter: blur(14px);
    color: var(--text-main);
    font-weight: 700;
    user-select: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.86rem;
    padding: clamp(0.95rem, 3vw, 1.25rem);
    box-shadow:
        inset 0 0 0 1px rgba(255, 255, 255, 0.04),
        inset 0 -34px 50px rgba(0, 0, 0, 0.28);
    animation: revealPulse 3s ease-in-out infinite, revealScanline 8s linear infinite;
    transition:
        border-color calc(120ms * max(var(--anim-speed), 0.01)) linear,
        box-shadow calc(160ms * max(var(--anim-speed), 0.01)) ease,
        transform calc(120ms * max(var(--anim-speed), 0.01)) ease;
}

.reveal-mask.holding {
    border-color: color-mix(in oklab, var(--accent) 84%, white);
    box-shadow:
        inset 0 0 0 1px rgba(77, 215, 255, 0.35),
        0 0 0 1px rgba(77, 215, 255, 0.28),
        0 0 32px rgba(77, 215, 255, 0.26),
        0 0 48px rgba(77, 215, 255, 0.12);
    animation: holdShake 0.15s linear infinite;
}

.reveal-mask.charged {
    border-color: color-mix(in oklab, var(--success) 58%, var(--accent));
    box-shadow:
        inset 0 0 0 1px rgba(122, 255, 214, 0.28),
        0 0 0 1px rgba(122, 255, 214, 0.2),
        0 0 36px rgba(67, 232, 175, 0.24),
        0 0 52px rgba(67, 232, 175, 0.14);
    animation: none;
}

.reveal-mask-title {
    font-size: clamp(1.05rem, 3.8vw, 1.28rem);
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: color-mix(in oklab, var(--text-main) 86%, var(--accent));
    text-shadow: 0 0 12px rgba(77, 215, 255, 0.28);
}

.reveal-mask-progress {
    width: min(100%, 360px);
}

.reveal-mask-progress-track {
    position: relative;
    display: block;
    width: 100%;
    height: 24px;
    border-radius: 999px;
    overflow: hidden;
    background:
        linear-gradient(110deg, transparent 33%, rgba(255, 255, 255, 0.06) 50%, transparent 67%),
        linear-gradient(180deg, rgba(255, 255, 255, 0.17), rgba(255, 255, 255, 0.07)),
        rgba(5, 10, 16, 0.88);
    background-size: 200% 100%, 100% 100%, 100% 100%;
    animation: trackShimmer 2.5s ease-in-out infinite;
    border: 1px solid rgba(118, 187, 255, 0.5);
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.18),
        inset 0 -5px 12px rgba(0, 0, 0, 0.32),
        0 0 18px rgba(77, 215, 255, 0.2);
}

.reveal-mask-progress-grid {
    position: absolute;
    inset: 0;
    background-image: repeating-linear-gradient(90deg, rgba(255, 255, 255, 0.13) 0 1px, transparent 1px 8%);
    opacity: 0.32;
    pointer-events: none;
}

.reveal-mask-progress-fill {
    width: 100%;
    height: 100%;
    background:
        linear-gradient(180deg, rgba(255, 255, 255, 0.26) 0%, rgba(255, 255, 255, 0) 42%),
        repeating-linear-gradient(110deg,
            color-mix(in oklab, var(--accent) 74%, white) 0 14px,
            color-mix(in oklab, var(--accent) 56%, #8ef2ff) 14px 28px),
        linear-gradient(90deg, color-mix(in oklab, var(--accent) 72%, white), var(--accent), color-mix(in oklab, var(--success) 66%, white));
    transform-origin: left center;
    transition: transform 70ms linear;
    will-change: transform;
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.24),
        0 0 18px rgba(77, 215, 255, 0.32);
}

.reveal-mask-progress-glow {
    position: absolute;
    inset-block: -7px;
    inset-inline-start: 0;
    width: 34px;
    border-radius: 999px;
    pointer-events: none;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.78) 0 26%, rgba(77, 215, 255, 0.55) 32%, transparent 72%);
    filter: blur(1.1px);
    opacity: 0.92;
    transform: translateX(0%);
    transition: transform 70ms linear;
}

.reveal-mask-percentage {
    font-size: 1.02rem;
    font-weight: 700;
    color: color-mix(in oklab, var(--text-main) 86%, var(--accent));
    letter-spacing: 0.05em;
    text-shadow: 0 0 10px rgba(77, 215, 255, 0.3);
}

.reveal-mask-helper {
    color: color-mix(in oklab, var(--text-soft) 92%, var(--accent));
    font-size: 0.82rem;
    font-weight: 600;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    min-height: 1.2rem;
}

/* ─── Timer & Progress ─── */
.cooldown-text {
    color: color-mix(in oklab, var(--text-soft) 90%, var(--accent));
    margin-block-start: var(--space-2);
    font-weight: 600;
}

.timer-card h2 {
    font-size: clamp(2.7rem, 17vw, 4.1rem);
}

.countdown-value {
    font-size: clamp(2rem, 15vw, 3.4rem);
    line-height: 1;
}

.progress-track {
    margin-block-start: var(--space-2);
    width: 100%;
    height: 16px;
    border-radius: 999px;
    position: relative;
    background:
        linear-gradient(180deg, rgba(255, 255, 255, 0.16), rgba(255, 255, 255, 0.05)),
        rgba(6, 11, 18, 0.9);
    overflow: hidden;
    border: 1px solid rgba(124, 168, 223, 0.36);
    box-shadow:
        inset 0 2px 5px rgba(0, 0, 0, 0.34),
        inset 0 0 0 1px rgba(255, 255, 255, 0.06),
        0 0 14px rgba(77, 215, 255, 0.12);
}

.progress-track::after {
    content: '';
    position: absolute;
    inset-block: 0;
    inset-inline-start: -45%;
    width: 45%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.16), transparent);
    animation: progress-scan 1.7s linear infinite;
    pointer-events: none;
}

.progress-fill {
    height: 100%;
    border-radius: inherit;
    background:
        linear-gradient(180deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0)),
        repeating-linear-gradient(110deg,
            color-mix(in oklab, var(--accent) 72%, white) 0 14px,
            color-mix(in oklab, var(--accent) 56%, #9ffcff) 14px 28px),
        linear-gradient(90deg, var(--accent), color-mix(in oklab, var(--accent) 62%, white));
    transition: width calc(220ms * max(var(--anim-speed), 0.01)) linear;
    box-shadow:
        0 0 0 1px rgba(255, 255, 255, 0.1),
        0 0 18px rgba(77, 215, 255, 0.33);
    background-size: auto, 34px 100%, auto;
}

.progress-fill.warning {
    background:
        linear-gradient(180deg, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0)),
        repeating-linear-gradient(120deg, rgba(255, 179, 92, 0.92) 0 14px, rgba(255, 97, 66, 0.95) 14px 28px),
        linear-gradient(90deg, #ff8a3d, #ff4b3f);
    box-shadow: 0 0 12px rgba(255, 74, 69, 0.42);
}

@keyframes progress-scan {
    0% {
        transform: translateX(0);
    }

    100% {
        transform: translateX(330%);
    }
}

/* ─── Recommend Badge ─── */
.recommend-badge {
    display: inline-flex;
    margin-inline-start: 0.35rem;
    padding: 0.1rem 0.45rem;
    border-radius: 999px;
    background: color-mix(in oklab, var(--accent) 22%, transparent);
    color: color-mix(in oklab, var(--accent) 80%, white);
    font-size: 0.72rem;
    font-weight: 600;
    letter-spacing: 0.03em;
    border: 1px solid color-mix(in oklab, var(--accent) 35%, transparent);
}

/* ─── Summary/Choice ─── */
.word-reveal {
    background: var(--panel);
    border: 1px solid var(--line);
    border-radius: var(--radius-1);
    padding: var(--space-2);
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
}

.word-pill {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    margin-inline-start: 0.5rem;
    background: rgba(56, 217, 197, 0.1);
    border: 1px solid rgba(56, 217, 197, 0.25);
    border-radius: var(--radius-2);
    font-weight: 600;
    color: var(--accent-primary);
    font-family: var(--font-body);
}

.word-list {
    margin-inline-start: 0.35rem;
    color: var(--text-soft);
    overflow-wrap: anywhere;
    word-break: break-word;
}

.choice-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(12rem, 100%), 1fr));
    justify-items: stretch;
    align-items: stretch;
    gap: var(--space-2);
    margin-block-start: var(--space-2);
}

.choice-card {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-weight: 600;
    line-height: var(--lh-body);
    padding-block: var(--space-3);
    padding-inline: var(--space-4);
    border: 1px solid var(--stroke-1);
    background: linear-gradient(162deg, rgba(120, 180, 255, 0.1), rgba(8, 14, 25, 0.95));
    overflow-wrap: anywhere;
}

.choice-card.selected {
    border-color: color-mix(in oklab, var(--accent) 70%, white);
    box-shadow: 0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent);
}

/* ─── Result Winner Banner ─── */
.result-winner-banner {
    text-align: center;
    padding: 1.25rem 1rem;
    border-radius: var(--radius-3);
    font-size: clamp(1.1rem, 4vw, 1.4rem);
    font-weight: 700;
    letter-spacing: 0.02em;
    line-height: 1.5;
    position: relative;
    overflow: hidden;
}

.result-winner-banner.spies-won {
    background: linear-gradient(135deg, rgba(229, 62, 62, 0.15), rgba(229, 62, 62, 0.05));
    border: 1px solid rgba(229, 62, 62, 0.3);
    color: #ff6b6b;
    text-shadow: 0 0 20px rgba(229, 62, 62, 0.3);
}

.result-winner-banner.citizens-won {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05));
    border: 1px solid rgba(34, 197, 94, 0.3);
    color: #4ade80;
    text-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
}

.result-winner-banner::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.03) 50%, transparent 100%);
    animation: resultShimmer 3s ease-in-out infinite;
}

/* ─── Guess Countdown & Flash ─── */
.guess-countdown {
    font-family: var(--font-hud);
    font-size: clamp(2.5rem, 10vw, 4rem);
    font-weight: 700;
    color: var(--accent-primary);
    text-shadow: 0 0 30px rgba(56, 217, 197, 0.4);
    letter-spacing: 0.1em;
    text-align: center;
    animation: countdownPulse 1s ease-in-out infinite;
}

.guess-countdown.urgent {
    color: var(--accent-danger);
    text-shadow: 0 0 30px rgba(229, 62, 62, 0.4);
    animation: countdownPulse 0.5s ease-in-out infinite;
}

.guess-required-flash {
    text-align: center;
    color: var(--accent-danger);
    font-weight: 700;
    font-size: 1rem;
    animation: flashWarning 0.8s ease-in-out infinite;
    padding: 0.75rem;
    border: 1px solid rgba(229, 62, 62, 0.3);
    border-radius: var(--radius-2);
    background: rgba(229, 62, 62, 0.08);
}

/* ─── Access Modes ─── */
.access-magnify .reveal-content {
    font-size: 1.55rem;
    line-height: 1.28;
}

.access-magnify .word-display {
    font-size: clamp(2.9rem, 15vw, 4.3rem);
    letter-spacing: 0.08em;
}

.access-magnify .role-title {
    font-size: clamp(2rem, 9vw, 2.8rem);
}

.access-long {
    transform: scale(1.22);
    transform-origin: top center;
}

.access-long .reveal-content {
    font-size: 1.45rem;
}

.access-long .role-title {
    font-size: clamp(2rem, 8vw, 2.7rem);
}

.access-long .word-display {
    font-size: clamp(2.7rem, 13vw, 4rem);
}

.access-blur-reduced .reveal-mask {
    backdrop-filter: blur(6px);
}

.history-section h2 {
    margin-block-end: var(--space-2);
}

.history-section--focused {
    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.14), 0 0 22px rgba(255, 255, 255, 0.12);
    border-radius: var(--radius-2);
    padding: 0.2rem;
}

.setup-insights,
.reveal-stage-hud,
.resolution-stage-hud {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(9.1rem, 100%), 1fr));
    justify-items: stretch;
    align-items: stretch;
    gap: var(--space-2);
    padding-block: var(--space-2);
    padding-inline: var(--space-2);
}

.reveal-stage-hud .metric-chip,
.setup-insights .metric-chip {
    min-height: 62px;
    background: rgba(255, 255, 255, 0.06);
}

.reveal-stage-hud,
.resolution-stage-hud {
    grid-template-columns: repeat(auto-fit, minmax(min(7.2rem, 100%), 1fr));
}

.stage-pill {
    font-family: var(--font-hud);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.4rem 1rem;
    border-radius: 999px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    color: var(--text-muted);
    transition: all 300ms ease;
    min-height: 42px;
    inline-size: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.stage-pill.active {
    background: linear-gradient(135deg, rgba(56, 217, 197, 0.15), rgba(56, 217, 197, 0.05));
    border-color: rgba(56, 217, 197, 0.4);
    color: var(--accent-primary);
    box-shadow: 0 0 12px rgba(56, 217, 197, 0.15);
}

.settings-section {
    gap: var(--space-2);
}

.settings-section .actions-row {
    flex-wrap: wrap;
}

.settings-section .section-heading {
    margin-block-end: var(--space-1);
    padding: 0;
}

.settings-section .section-heading h2 {
    font-size: clamp(1.05rem, 4vw, 1.45rem);
    line-height: var(--lh-heading);
    letter-spacing: 0.06em;
}

.ui-debugger-panel,
.ui-debugger-report,
.ui-debugger-errors {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.ui-debugger-actions {
    justify-content: flex-start;
}

.ui-debugger-list {
    margin: 0;
    padding-inline-start: 1rem;
    display: grid;
    gap: var(--space-1);
}

.ui-debugger-list li {
    line-height: var(--lh-body);
}

.ui-debugger-list li p {
    margin-block-start: 0.2rem;
    color: var(--text-soft);
    overflow-wrap: anywhere;
}

.modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(4, 7, 12, 0.76);
    backdrop-filter: blur(4px);
    display: flex;
    justify-content: center;
    align-items: center;
    padding: var(--space-3);
    z-index: var(--z-modal);
}

.modal {
    width: min(100%, 640px);
    max-height: min(88dvh, 800px);
    overflow: auto;
    padding: var(--space-3);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    border: 1px solid color-mix(in oklab, var(--stroke-1) 90%, white 10%);
    box-shadow: 0 14px 38px rgba(0, 0, 0, 0.45);
    background:
        linear-gradient(135deg, rgba(255, 79, 109, 0.1), transparent 36%),
        linear-gradient(162deg, rgba(128, 190, 255, 0.1), rgba(7, 13, 24, 0.96));
}

.modal ul {
    margin: 0;
    padding-inline-start: 1.2rem;
}

.modal h2 {
    margin-block-end: 0.2rem;
}

.modal-section {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    padding: var(--space-2);
    border: 1px solid var(--stroke-2);
    border-radius: var(--radius-1);
    background: color-mix(in oklab, var(--surface-2) 86%, transparent);
}

.modal-section h3 {
    margin: 0;
}

.modal-actions {
    display: flex;
    gap: var(--space-2);
    justify-content: flex-end;
    padding-block-start: var(--space-1);
    border-block-start: 1px solid color-mix(in oklab, var(--stroke-2) 80%, transparent);
}

/* ─── AI Desk ─── */
.ai-skip-card {
    text-align: center;
}

.ai-desk-modal {
    width: min(100%, 740px);
}

.ai-desk-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-2);
}

.ai-desk-title {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
}

.ai-desk-title h2 {
    margin: 0;
}

.ai-desk-close {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2.6rem;
    height: 2.6rem;
    border-radius: 999px;
    border: 1px solid var(--stroke-1);
    background: rgba(255, 255, 255, 0.04);
    color: var(--text-main);
}

.ai-voice-room {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-1);
    border: 1px dashed color-mix(in oklab, var(--accent) 35%, transparent);
    background: color-mix(in oklab, var(--surface-2) 70%, transparent);
}

.ai-voice-agent-card {
    display: grid;
    gap: var(--space-1);
    border: 1px solid color-mix(in oklab, var(--accent) 30%, var(--stroke-1));
    border-radius: var(--radius-1);
    padding: var(--space-2);
    background:
        linear-gradient(150deg, color-mix(in oklab, var(--accent) 10%, transparent), transparent 60%),
        color-mix(in oklab, var(--surface-1) 88%, transparent);
}

.ai-voice-agent-meta {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: var(--space-2);
}

.ai-voice-agent-label {
    color: var(--text-soft);
    font-size: 0.78rem;
    letter-spacing: 0.05em;
}

.ai-voice-agent-name {
    color: color-mix(in oklab, var(--accent-2) 85%, white);
    font-size: 1.02rem;
    font-weight: 800;
}

.ai-voice-state {
    margin: 0;
    font-weight: 700;
    color: color-mix(in oklab, var(--text-main) 90%, var(--accent));
}

.ai-voice-wave {
    display: flex;
    align-items: flex-end;
    gap: 0.32rem;
    min-height: 1.5rem;
}

.ai-voice-wave-bar {
    inline-size: 5px;
    block-size: 0.5rem;
    border-radius: 999px;
    background: color-mix(in oklab, var(--accent) 45%, var(--text-soft));
    opacity: 0.48;
}

.ai-voice-wave.is-active .ai-voice-wave-bar {
    animation: aiVoiceWave 820ms ease-in-out infinite;
    opacity: 1;
}

.ai-voice-wave.is-processing .ai-voice-wave-bar {
    animation: aiVoiceThinking 900ms ease-in-out infinite;
}

.ai-voice-wave.is-active .ai-voice-wave-bar:nth-child(2),
.ai-voice-wave.is-processing .ai-voice-wave-bar:nth-child(2) {
    animation-delay: 100ms;
}

.ai-voice-wave.is-active .ai-voice-wave-bar:nth-child(3),
.ai-voice-wave.is-processing .ai-voice-wave-bar:nth-child(3) {
    animation-delay: 180ms;
}

.ai-voice-wave.is-active .ai-voice-wave-bar:nth-child(4),
.ai-voice-wave.is-processing .ai-voice-wave-bar:nth-child(4) {
    animation-delay: 260ms;
}

.ai-voice-wave.is-active .ai-voice-wave-bar:nth-child(5),
.ai-voice-wave.is-processing .ai-voice-wave-bar:nth-child(5) {
    animation-delay: 340ms;
}

@keyframes aiVoiceWave {

    0%,
    100% {
        block-size: 0.45rem;
    }

    50% {
        block-size: 1.45rem;
    }
}

@keyframes aiVoiceThinking {

    0%,
    100% {
        block-size: 0.4rem;
        opacity: 0.45;
    }

    50% {
        block-size: 1rem;
        opacity: 0.9;
    }
}

@keyframes fire-ember {
    0%, 100% {
        filter: brightness(0.95) saturate(1);
        box-shadow: 0 0 var(--fire-spread, 4px) rgba(255, 140, 40, calc(var(--fire-glow, 0.15) - 0.05));
    }
    50% {
        filter: brightness(1.12) saturate(1.15);
        box-shadow: 0 0 calc(var(--fire-spread, 4px) * 1.4) rgba(255, 140, 40, calc(var(--fire-glow, 0.15) + 0.08));
    }
}

@keyframes fire-flame {
    0%, 100% {
        transform: scale(1);
        filter: brightness(0.94) saturate(1);
    }
    50% {
        transform: scale(var(--fire-scale, 1.02));
        filter: brightness(1.16) saturate(1.2);
    }
}

@keyframes fire-inferno {
    0% {
        transform: translateY(0) scale(1);
        filter: brightness(0.93);
    }
    35% {
        transform: translateY(-0.5px) scale(var(--fire-scale, 1.04));
        filter: brightness(1.15);
    }
    70% {
        transform: translateY(0.3px) scale(calc(var(--fire-scale, 1.04) - 0.01));
        filter: brightness(1.08);
    }
    100% {
        transform: translateY(0) scale(1);
        filter: brightness(0.95);
    }
}

@keyframes fire-mythic {
    0% {
        transform: translateY(0) scale(1);
        filter: brightness(0.9) hue-rotate(0deg);
    }
    30% {
        transform: translateY(-1px) scale(var(--fire-scale, 1.06));
        filter: brightness(1.2) hue-rotate(5deg);
    }
    60% {
        transform: translateY(0.5px) scale(calc(var(--fire-scale, 1.06) - 0.02));
        filter: brightness(1.1) hue-rotate(-3deg);
    }
    100% {
        transform: translateY(0) scale(1);
        filter: brightness(0.92) hue-rotate(0deg);
    }
}

@keyframes fire-legendary {
    0% {
        transform: translateY(0) scale(1);
        filter: brightness(0.95) hue-rotate(0deg);
    }
    25% {
        transform: translateY(-1.2px) scale(var(--fire-scale, 1.08));
        filter: brightness(1.25) hue-rotate(8deg);
    }
    50% {
        transform: translateY(0.3px) scale(calc(var(--fire-scale, 1.08) - 0.01));
        filter: brightness(1.15) hue-rotate(-5deg);
    }
    75% {
        transform: translateY(-0.8px) scale(calc(var(--fire-scale, 1.08) - 0.02));
        filter: brightness(1.2) hue-rotate(4deg);
    }
    100% {
        transform: translateY(0) scale(1);
        filter: brightness(0.97) hue-rotate(0deg);
    }
}

@keyframes fire-tongue {
    0%, 100% {
        transform: scaleY(0.7) scaleX(0.95);
        opacity: var(--fire-glow, 0.5);
    }
    30% {
        transform: scaleY(1.1) scaleX(1.05);
        opacity: calc(var(--fire-glow, 0.5) + 0.15);
    }
    60% {
        transform: scaleY(0.85) scaleX(0.98);
        opacity: calc(var(--fire-glow, 0.5) + 0.05);
    }
}

@keyframes fire-aura {
    from {
        opacity: 0.3;
        transform: scale(0.98);
    }
    to {
        opacity: 0.6;
        transform: scale(1.04);
    }
}

@keyframes fire-ring {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.ai-voice-room .status-banner {
    display: inline-flex;
    align-items: center;
    gap: 0.45rem;
}

.ai-voice-cta {
    display: flex;
    justify-content: center;
    padding-block: var(--space-1);
}

.ai-voice-cta .game-button {
    width: min(100%, 360px);
    min-height: 54px;
}

.ai-chat-log {
    border-radius: var(--radius-1);
    border: 1px solid var(--stroke-1);
    background: rgba(2, 5, 10, 0.55);
    padding: var(--space-2);
    max-height: 44dvh;
    overflow: auto;
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.ai-chat-empty {
    margin: 0;
    padding: var(--space-2);
    text-align: center;
}

.ai-chat-bubble {
    max-width: min(92%, 34rem);
    padding: 0.65rem 0.75rem;
    border-radius: 1rem;
    border: 1px solid rgba(255, 255, 255, 0.12);
    background: rgba(255, 255, 255, 0.06);
    line-height: var(--lh-body);
    overflow-wrap: anywhere;
}

.ai-chat-bubble.from-user {
    align-self: flex-end;
    border-color: color-mix(in oklab, var(--accent) 55%, rgba(255, 255, 255, 0.12));
    background: color-mix(in oklab, var(--accent) 14%, rgba(255, 255, 255, 0.05));
}

.ai-chat-bubble.from-ai {
    align-self: flex-start;
    border-color: rgba(255, 255, 255, 0.14);
    background: rgba(255, 255, 255, 0.05);
}

.ai-chat-controls {
    display: grid;
    grid-template-columns: auto minmax(0, 1fr) auto;
    align-items: center;
    gap: var(--space-2);
}

.ai-chat-input {
    width: 100%;
}

.ai-desk-actions {
    justify-content: flex-end;
}

:root[data-motion='reduced'] .level-chip--ember,
:root[data-motion='reduced'] .level-chip--flame,
:root[data-motion='reduced'] .level-chip--inferno,
:root[data-motion='reduced'] .level-chip--mythic-fire,
:root[data-motion='reduced'] .level-chip--legendary {
    animation: none;
}

:root[data-motion='reduced'] .level-chip--flame::after,
:root[data-motion='reduced'] .level-chip--inferno::before,
:root[data-motion='reduced'] .level-chip--inferno::after,
:root[data-motion='reduced'] .level-chip--mythic-fire::before,
:root[data-motion='reduced'] .level-chip--mythic-fire::after,
:root[data-motion='reduced'] .level-chip--legendary::before,
:root[data-motion='reduced'] .level-chip--legendary::after {
    display: none;
}

/* ═══════════ RTL ADAPTATIONS (Components) ═══════════ */
html[dir='rtl'] .player-main,
html[dir='rtl'] .history-card,
html[dir='rtl'] .phase-card,
html[dir='rtl'] .timer-card,
html[dir='rtl'] .reveal-content,
html[dir='rtl'] .reveal-meta,
html[dir='rtl'] .status-banner,
html[dir='rtl'] .form-field {
    text-align: right;
}

html[dir='rtl'] .action-main {
    justify-content: flex-start;
}

html[dir='rtl'] .action-leading {
    text-align: right;
}

html[dir='rtl'] .reveal-mask-progress-fill {
    transform-origin: right center;
}

html[dir='rtl'] .reveal-mask-progress-glow {
    inset-inline-start: auto;
    inset-inline-end: 0;
}

/* ═══════════ MEDIA QUERIES (Components) ═══════════ */
@media (max-width: 560px) {

    .sticky-action-bar,
    .reveal-action-bar {
        position: sticky;
        inset-block-end: var(--space-2);
        margin-top: auto;
    }

    .setup-action-bar {
        position: static;
        inset-block-end: auto;
    }


    .modal-actions {
        flex-direction: column;
    }

    .input-row {
        flex-direction: column;
        align-items: stretch;
    }

    .ai-chat-controls {
        grid-template-columns: 1fr;
    }

    .ai-chat-controls .game-button {
        width: 100%;
    }

    .ai-voice-cta .game-button {
        width: 100%;
    }

    .ai-orchestrator-strip {
        gap: 0.65rem;
        display: grid;
    }

    .ai-orchestrator-strip-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
    }

    .ai-monitor-grid {
        display: grid;
        gap: 0.5rem;
        margin-top: 0.35rem;
    }

    .ai-monitor-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        padding: 0.45rem 0.6rem;
        border-radius: 0.5rem;
        background: rgba(255, 255, 255, 0.03);
    }

    .ai-monitor-text {
        display: grid;
        gap: 0.4rem;
    }

    .ai-monitor-text p {
        margin: 0;
        line-height: 1.5;
    }

    .link-like-btn {
        border: none;
        background: none;
        color: var(--tone-info-strong);
        text-decoration: underline;
        cursor: pointer;
        font: inherit;
        padding: 0;
    }

    .ai-voice-agent-meta {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.15rem;
    }

    .primary-action-bar {
        flex-direction: row;
        padding: var(--space-2);
        gap: var(--space-2);
        align-items: center;
    }

    .primary-action-bar .game-button {
        padding: 0.5rem 0.8rem;
        font-size: 0.9rem;
    }

    .glass-card {
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
    }

    .action-main,
    .action-leading {
        width: 100%;
    }

    .stage-pill {
        font-size: 0.9rem;
    }

    .reveal-content {
        padding: 0.95rem;
    }

    .role-title {
        font-size: clamp(1.4rem, 7vw, 2rem);
    }

    .player-row {
        grid-template-columns: auto minmax(0, 1fr) auto;
        grid-template-areas: "avatar main actions";
        align-items: center;
        gap: var(--space-2);
    }

    .player-avatar {
        width: 42px;
        height: 42px;
    }

    .player-actions {
        flex-direction: row;
        width: auto;
        justify-content: flex-end;
        margin-block-start: 0;
        display: flex;
        gap: var(--space-1);
    }

    .player-actions .game-button {
        flex: 0 0 auto;
        min-width: 0;
        width: auto;
        padding: 0.4rem;
    }

    .player-nameplate__row {
        gap: 0.25rem;
    }

    .medal-chip {
        max-width: 7rem;
        font-size: 0.58rem;
        padding: 0.15rem 0.4rem;
    }

    .medal-catalog-grid {
        grid-template-columns: repeat(auto-fit, minmax(min(6.3rem, 100%), 1fr));
    }

    .resolution-restart-row {
        flex-direction: column;
        align-items: stretch;
    }

    .stats-grid {
        grid-template-columns: minmax(0, 1fr);
        gap: var(--space-1);
    }

    .case-actions {
        flex-direction: row;
        flex-wrap: wrap;
        gap: var(--space-1);
    }

    .case-actions .game-button {
        flex: 1 1 auto;
        width: auto;
        min-width: 40%;
    }

    .section-heading {
        align-items: flex-start;
        flex-direction: column;
        gap: var(--space-1);
    }

    .section-count-badge {
        font-size: 0.74rem;
    }

    .section-card,
    .player-card,
    .history-card,
    .setting-card,
    .phase-card,
    .timer-card,
    .spy-count-panel,
    .handoff-card,
    .reveal-card {
        padding: var(--space-2);
    }

    .player-select-grid.compact {
        grid-template-columns: repeat(auto-fit, minmax(min(5.8rem, 100%), 1fr));
        gap: var(--space-1);
    }

    .pick-card {
        padding: var(--space-2);
    }

    .reveal-action-bar {
        padding: var(--space-2);
    }

    .reveal-action-bar .action-main,
    .reveal-action-bar .action-main .next-btn {
        width: 100%;
    }

    .spy-count-panel {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
    }

    .setup-spy-panel {
        flex-direction: column;
        align-items: stretch;
        justify-content: flex-start;
    }

    .pill-row {
        width: auto;
        display: inline-flex;
    }

    .setup-pill-row {
        width: 100%;
        display: grid;
    }

    .pill-btn {
        width: auto;
        min-width: 44px;
    }

    .home-hud .game-button--icon {
        width: 31%;
        padding-block: var(--space-3);
        font-size: 0.66rem;
        letter-spacing: 0.08em;
    }
}

@media (max-width: 420px) {

    /* Tighter spacing for very small screens */
    :root {
        --space-1: 0.4rem;
        --space-2: 0.6rem;
        --space-3: 0.8rem;
        --space-4: 1rem;
    }

    .choice-grid {
        grid-template-columns: repeat(auto-fit, minmax(min(9rem, 100%), 1fr));
    }

    .primary-action-bar .action-main button,
    .primary-action-bar .action-main a {
        width: 100%;
    }

    .setup-action-bar .action-main {
        width: 100%;
        display: grid;
        grid-template-columns: 1fr;
    }

    .setup-action-leading {
        width: max-content;
    }

    .metric-chip {
        min-height: 48px;
        padding-block: var(--space-1);
        padding-inline: var(--space-2);
    }

    .metric-chip strong {
        font-size: 1.05rem;
    }

    .metric-chip span {
        font-size: 0.68rem;
    }

    .setup-insights,
    .reveal-stage-hud,
    .resolution-stage-hud {
        grid-template-columns: repeat(2, 1fr);
    }

    .spy-count-panel {
        gap: var(--space-2);
    }

    .pill-btn {
        min-width: 46px;
        min-height: 38px;
        padding: 0.3rem 0.6rem;
        font-size: 0.82rem;
    }

    .home-hud .game-button--hero {
        padding-block: var(--space-4);
        font-size: 1rem;
    }

    .case-badge {
        min-height: 1.85rem;
        font-size: 0.7rem;
    }

    .ui-debugger-actions .game-button {
        flex: 1 1 100%;
    }

    .ui-debugger-list li p {
        font-size: 0.77rem;
    }
}

@media (max-height: 740px) {
    .metric-chip {
        padding: 0.65rem 0.85rem;
    }

    .pick-card {
        padding: var(--space-2);
    }
}

@keyframes resultShimmer {
    0%, 100% { opacity: 0; transform: translateX(-100%); }
    50% { opacity: 1; transform: translateX(100%); }
}

@keyframes countdownPulse {
    0%, 100% { transform: scale(1); opacity: 0.9; }
    50% { transform: scale(1.05); opacity: 1; }
}

@keyframes flashWarning {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}
